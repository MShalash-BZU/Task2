<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Remote Users Table</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1>Users Table</h1>

      <div class="controls">
        <label>
          <span class="label">Search:</span>
          <input
            id="search"
            type="search"
            placeholder="Search name, email, company..."
          />
        </label>
      </div>

      <div id="status"></div>

      <div class="table-wrap">
        <table id="table">
          <thead>
            <tr>
              <th data-key="id">ID</th>
              <th data-key="name">Name</th>
              <th data-key="email">Email</th>
              <th data-key="company">Company</th>
              <th data-key="city">City</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script>
      let allUsers = [];

      // تحديد العناصر
      const tbody = document.querySelector("#table tbody");
      const searchInput = document.getElementById("search");
      const status = document.getElementById("status"); // عنصر عرض الحالة

      // تم إزالة متغيرات الصفحة
      let filtered = [];

      function setControlsDisabled(disabled) {
        searchInput.disabled = disabled;
      }

      function render() {
        const total = filtered.length;

        tbody.innerHTML = filtered
          .map(
            (u) => `
        <tr>
          <td>${u.id}</td>
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td>${u.company.name}</td>
          <td>${u.address.city}</td>
        </tr>`
          )
          .join("");

        // تحديث الحالة لتعرض العدد الإجمالي
        status.textContent = `Showing ${total} users.`;
      }

      /**
       * دالة "applyFilter" كما هي، ولكن بدون إعادة تعيين الصفحة
       */
      function applyFilter() {
        const q = searchInput.value.trim().toLowerCase();

        filtered = allUsers.filter(
          (u) =>
            u.name.toLowerCase().includes(q) ||
            u.email.toLowerCase().includes(q) ||
            u.company.name.toLowerCase().includes(q) ||
            u.address.city.toLowerCase().includes(q)
        );
        render(); // فقط قم بإعادة العرض
      }

      // إضافة مستمع حدث البحث فقط
      searchInput.addEventListener("input", applyFilter);

      // تم إزالة مستمعي أحداث الأزرار و "perPage"

      /**
       * دالة "initApp" لجلب البيانات وتشغيل التطبيق
       */
      async function initApp() {
        status.textContent = "Loading users...";
        setControlsDisabled(true);

        try {
          const response = await fetch(
            "https://jsonplaceholder.typicode.com/users"
          );
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }

          allUsers = await response.json();
          filtered = [...allUsers];

          setControlsDisabled(false); // تمكين أزرار التحكم
          render(); // عرض البيانات لأول مرة
        } catch (error) {
          console.error("Failed to fetch users:", error);
          status.textContent = "Error loading data. Please refresh the page.";
        }
      }

      // تشغيل التطبيق
      initApp();
    </script>
  </body>
</html>
